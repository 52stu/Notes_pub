#!/bin/bash
#######################static IP##########################

##########updata AND install some software##############
echo -e "\n\n\n\033[31m ################ Start update ################ \033[0m"
apt-get update

echo -e "\n\n\n\033[31m ################ install scanner and basic tools. ################ \033[0m"
apt-get install vim -y
apt-get install nmap -y
apt-get install git -y
apt install zmap -y
apt install masscan -y
apt install python-pip
apt install unzip

###############install some pentesting software################

echo -e "\n\n\n \033[31m ################ install SQLMap ################ \033[0m"
git clone https://github.com/sqlmapproject/sqlmap.git /opt/sqlmap
echo "alias sqlmap='python /opt/sqlmap/sqlmap.py'">> ~/.bashrc
`source ~/.bashrc`

echo -e "\n\n\n \033[31m ################  install subDomainsBrute ################ \033[0m"
git clone https://github.com/lijiejie/subDomainsBrute /opt/subDomainsBrute
pip install dnspython gevent

echo -e "\n\n\n \033[31m ################ install teemo ################ \033[0m"
git clone https://github.com/bit4woo/teemo /opt/teemo
pip install -r /opt/teemo/requirements.txt

echo -e "\n\n\n \033[31m ################  install Metasploit ################ \033[0m"
curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall
chmod 755 msfinstall
./msfinstall

echo -e "\n\n\n \033[31m ################  install java 8u171 ################ \033[0m"
wget https://repo.huaweicloud.com/java/jdk/8u171-b11/jdk-8u171-linux-x64.tar.gz
tar -zxvf jdk-8u171-linux-x64.tar.gz -C /usr/lib/
echo "export JAVA_HOME=/usr/lib/jdk1.8.0_171/" >> /etc/profile
echo "export JRE_HOME=/usr/lib/jdk1.8.0_171/jre" >> /etc/profile
echo "export PATH=\$JAVA_HOME/bin:\$JAVA_HOME/jre/bin:\$PATH" >> /etc/profile
echo "export CLASSPATH=\$CLASSPATH:.:\$JAVA_HOME/lib:\$JAVA_HOME/jre/lib" >> /etc/profile
`source /etc/profile`
rm jdk-8u171-linux-x64.tar.gz


echo -e "\n\n\n \033[31m ################  install Cobalt Strike ################ \033[0m"
git clone https://github.com/rsmudge/Malleable-C2-Profiles /opt/Malleable-C2-Profiles
mkdir /opt/CobaltStrike/
unzip /opt/CobaltStrike/CobaltStrike.zip

local_ip=`curl http://ip.3322.org`
echo "#!/bin/bash" >> RunCS.sh
passwordset=`tr -dc "0-9,a-z" < /dev/urandom | head -c 10`
echo "cd  /opt/CobaltStrike/ && chmod +x teamserver && nohup ./teamserver $local_ip $passwordset /opt/Malleable-C2-Profiles/normal/amazon.profile >/dev/null 2>&1 &" >> RunCS.sh
#######################################################################



echo -e "\n\n\n \033[31m ################  config ssh tunnel ################ \033[0m"
echo "AllowTcpForwarding yes" >>/etc/ssh/sshd_config
echo "GatewayPorts yes" >>/etc/ssh/sshd_config
echo "TCPKeepAlive yes" >>/etc/ssh/sshd_config
echo "PasswordAuthentication yes" >>/etc/ssh/sshd_config
`/etc/init.d/ssh restart`

echo -e "\n\n\n \033[31m ################  Add ssh tunnel user ################ \033[0m"
`useradd -s /bin/false  sshtunnel`
echo "sshtunnel:sshtunnel1234" | chpasswd


#######################################################################
echo -e "\n\n\n \033[31m ################  install shadowsocks ################ \033[0m"
wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubiBackup/doubi/master/ssr.sh && chmod +x ssr.sh && bash ssr.sh

echo -e "\n\n\n \033[0m ################  Modify ssh port ################ \033[0m"
sed -i 's/22/53291/g' /etc/ssh/sshd_config
sed -i 's/#Port/Port/g' /etc/ssh/sshd_config
/etc/init.d/ssh restart



########connection time############
echo "ClientAliveInterval 60" >>/etc/ssh/sshd_config
echo "ClientAliveCountMax 3" >>/etc/ssh/sshd_config

echo -e "\n\n\n \033[0m ################  ssh-keygen ################ \033[0m"
ssh-keygen -t rsa -P "" -f ~/.ssh/id_rsa
mv ~/.ssh/id_rsa.pub ~/.ssh/authorized_keys
cat ~/.ssh/id_rsa
rm ~/.ssh/id_rsa